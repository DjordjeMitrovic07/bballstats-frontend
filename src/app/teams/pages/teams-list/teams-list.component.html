<div class="page">
  <!-- header -->
  <div class="toolbar">
    <h1>Teams</h1>

    <div class="controls">
      <input
        type="text"
        placeholder="Filter by name / city"
        [(ngModel)]="query"
        (ngModelChange)="applyFilter()"
      />

      <button class="primary" *ngIf="admin" (click)="newTeam()">+ New Team</button>
    </div>
  </div>

  <div *ngIf="loading" class="state">Loading...</div>
  <div *ngIf="error" class="state error">{{ error }}</div>

  <div class="grid" *ngIf="!loading && !error">
    <div class="card" *ngFor="let t of filtered">
      <img
        [src]="teamImg(t.id)"
        (error)="imgFallback($event, 'team')"
        alt="logo"
        class="avatar clickable"
        (click)="openTeam(t)"
      />

      <div class="meta">
        <div class="name link" (click)="openTeam(t)">{{ t.name }}</div>
        <div class="sub">{{ t.city || '—' }} • Founded {{ t.foundedYear ?? t.foundedYear ?? '—' }}</div>
      </div>

      <div class="actions" *ngIf="admin">
        <button
          class="kebab-btn"
          (click)="toggleMenu(t.id); $event.stopPropagation()"
          aria-label="More"
        >⋮</button>

        <div class="menu" *ngIf="openMenuId === t.id">
          <button (click)="editTeam(t)">Edit</button>
          <button class="danger" (click)="deleteTeam(t)">Delete</button>
        </div>
      </div>
    </div>

    <div class="empty" *ngIf="filtered.length === 0">
      No teams match your filter.
    </div>
  </div>
</div>
